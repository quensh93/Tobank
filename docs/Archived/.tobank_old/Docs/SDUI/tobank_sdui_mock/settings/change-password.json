{
  "$schema": "tobank-sdui/v1/page",
  "version": "1.0.0",
  "pageId": "change_password",
  "title": {"fa": "تغییر رمز عبور", "en": "Change Password"},
  
  "appBar": {"type": "standard", "title": {"fa": "تغییر رمز عبور", "en": "Change Password"}},
  
  "body": {
    "type": "scrollable",
    "padding": 16,
    "children": [
      {"type": "card", "padding": 16, "backgroundColor": "#E3F2FD", "child": {"type": "row", "children": [
        {"type": "icon", "icon": "assets/icons/ic_info.svg", "color": "#1976D2"},
        {"type": "sized_box", "width": 12},
        {"type": "expanded", "child": {"type": "text", "text": {"fa": "رمز عبور باید حداقل ۸ کاراکتر شامل حروف و اعداد باشد", "en": "Password must be at least 8 characters with letters and numbers"}, "style": "bodySmall"}}
      ]}},
      
      {"type": "section", "margin": {"top": 24}, "child": {"type": "column", "children": [
        {"type": "password_field", "label": {"fa": "رمز عبور فعلی", "en": "Current Password"}, "bindTo": "currentPassword", "validation": {"required": true}},
        {"type": "password_field", "label": {"fa": "رمز عبور جدید", "en": "New Password"}, "margin": {"top": 16}, "bindTo": "newPassword", "validation": {"required": true, "minLength": 8, "pattern": "^(?=.*[A-Za-z])(?=.*\\d).+$"}, "strengthIndicator": true},
        {"type": "password_field", "label": {"fa": "تکرار رمز عبور جدید", "en": "Confirm New Password"}, "margin": {"top": 16}, "bindTo": "confirmPassword", "validation": {"required": true, "match": "newPassword"}}
      ]}},
      
      {"type": "section", "margin": {"top": 24}, "header": {"title": {"fa": "قوانین رمز عبور", "en": "Password Rules"}}, "child": {"type": "column", "children": [
        {"type": "password_rule", "rule": "minLength", "label": {"fa": "حداقل ۸ کاراکتر", "en": "At least 8 characters"}, "valid": "{{newPassword.length >= 8}}"},
        {"type": "password_rule", "rule": "hasLetter", "label": {"fa": "شامل حروف انگلیسی", "en": "Contains letters"}, "valid": "{{hasLetters(newPassword)}}", "margin": {"top": 8}},
        {"type": "password_rule", "rule": "hasNumber", "label": {"fa": "شامل اعداد", "en": "Contains numbers"}, "valid": "{{hasNumbers(newPassword)}}", "margin": {"top": 8}},
        {"type": "password_rule", "rule": "notSame", "label": {"fa": "متفاوت از رمز قبلی", "en": "Different from current"}, "valid": "{{newPassword !== currentPassword}}", "margin": {"top": 8}}
      ]}},
      
      {"type": "sized_box", "height": 100}
    ]
  },
  
  "bottomBar": {"type": "container", "padding": 16, "child": {"type": "elevated_button", "label": {"fa": "تغییر رمز عبور", "en": "Change Password"}, "fullWidth": true, "disabled": "{{!isFormValid}}", "onTap": {"type": "api_call", "endpoint": "auth/change-password", "method": "POST", "body": {"currentPassword": "{{currentPassword}}", "newPassword": "{{newPassword}}"}, "showLoading": true, "onSuccess": {"type": "sequence", "actions": [{"type": "show_toast", "message": {"fa": "رمز عبور تغییر کرد", "en": "Password changed"}}, {"type": "navigate_back"}]}, "onError": {"type": "show_error", "message": {"fa": "رمز عبور فعلی اشتباه است", "en": "Current password is incorrect"}}}}},
  
  "dataBindings": {
    "currentPassword": {"source": "form", "default": ""},
    "newPassword": {"source": "form", "default": ""},
    "confirmPassword": {"source": "form", "default": ""},
    "isFormValid": {"source": "computed", "formula": "currentPassword && newPassword.length >= 8 && hasLetters(newPassword) && hasNumbers(newPassword) && newPassword === confirmPassword && newPassword !== currentPassword"}
  }
}

