{
  "$schema": "tobank-sdui/v1/page",
  "version": "1.0.0",
  "pageId": "c2c_enter_amount",
  "pageType": "form",
  "title": {
    "fa": "مبلغ انتقال",
    "en": "Transfer Amount"
  },
  "requiresAuth": true,
  "analytics": {
    "screenName": "c2c_enter_amount",
    "screenClass": "CardToCardAmountPage"
  },
  
  "appBar": {
    "type": "standard",
    "title": {"fa": "مبلغ انتقال", "en": "Transfer Amount"},
    "showBackButton": true
  },
  
  "body": {
    "type": "scrollable",
    "children": [
      {
        "id": "step_indicator",
        "type": "step_indicator",
        "currentStep": 2,
        "steps": [
          {"label": {"fa": "کارت مبدا", "en": "Source"}},
          {"label": {"fa": "کارت مقصد", "en": "Destination"}},
          {"label": {"fa": "مبلغ", "en": "Amount"}},
          {"label": {"fa": "تایید", "en": "Confirm"}}
        ]
      },
      
      {
        "id": "transfer_summary",
        "type": "container",
        "padding": 16,
        "child": {
          "type": "card",
          "padding": 16,
          "child": {
            "type": "column",
            "children": [
              {
                "type": "row",
                "mainAxisAlignment": "spaceBetween",
                "children": [
                  {
                    "type": "column",
                    "crossAxisAlignment": "start",
                    "children": [
                      {
                        "type": "text",
                        "text": {"fa": "از کارت", "en": "From"},
                        "style": "bodySmall",
                        "color": "textSecondary"
                      },
                      {
                        "type": "text",
                        "text": "{{sourceCard.cardNumberMasked}}",
                        "style": "bodyMedium"
                      }
                    ]
                  },
                  {
                    "type": "icon",
                    "icon": "assets/icons/ic_arrow_left.svg",
                    "size": 24,
                    "color": "#E31837"
                  },
                  {
                    "type": "column",
                    "crossAxisAlignment": "end",
                    "children": [
                      {
                        "type": "text",
                        "text": {"fa": "به کارت", "en": "To"},
                        "style": "bodySmall",
                        "color": "textSecondary"
                      },
                      {
                        "type": "text",
                        "text": "{{formatCardNumber(destinationCardNumber)}}",
                        "style": "bodyMedium"
                      }
                    ]
                  }
                ]
              },
              {
                "type": "conditional",
                "condition": "{{destinationOwner}}",
                "whenTrue": {
                  "type": "container",
                  "margin": {"top": 8},
                  "child": {
                    "type": "text",
                    "text": "{{destinationOwner}}",
                    "style": "bodySmall",
                    "color": "#4CAF50",
                    "textAlign": "end"
                  }
                }
              }
            ]
          }
        }
      },
      
      {
        "id": "available_balance",
        "type": "container",
        "padding": {"horizontal": 16},
        "child": {
          "type": "text",
          "text": {"fa": "موجودی قابل انتقال: {{formatCurrency(sourceCard.balance)}} ریال", "en": "Available: {{formatCurrency(sourceCard.balance)}} Rials"},
          "style": "bodySmall",
          "color": "textSecondary"
        }
      },
      
      {
        "id": "amount_input",
        "type": "container",
        "padding": 16,
        "child": {
          "type": "currency_field",
          "label": {"fa": "مبلغ (ریال)", "en": "Amount (Rials)"},
          "hint": {"fa": "مبلغ مورد نظر را وارد کنید", "en": "Enter amount"},
          "currency": "IRR",
          "showToman": true,
          "maxValue": "{{sourceCard.balance}}",
          "minValue": 10000,
          "validation": {
            "required": true,
            "min": 10000,
            "max": "{{Math.min(sourceCard.balance, dailyLimit - usedLimit)}}",
            "errorMessages": {
              "min": {"fa": "حداقل مبلغ ۱۰,۰۰۰ ریال است", "en": "Minimum is 10,000 Rials"},
              "max": {"fa": "موجودی ناکافی یا بیش از سقف مجاز", "en": "Insufficient balance or exceeds limit"}
            }
          },
          "bindTo": "amount"
        }
      },
      
      {
        "id": "toman_display",
        "type": "conditional",
        "condition": "{{amount > 0}}",
        "whenTrue": {
          "type": "container",
          "padding": {"horizontal": 16},
          "child": {
            "type": "text",
            "text": "{{formatCurrency(amount / 10)}} تومان",
            "style": "bodyMedium",
            "color": "#E31837"
          }
        }
      },
      
      {
        "id": "quick_amounts",
        "type": "container",
        "padding": 16,
        "child": {
          "type": "wrap",
          "spacing": 8,
          "runSpacing": 8,
          "children": [
            {
              "type": "amount_chip",
              "amount": 5000000,
              "label": {"fa": "۵۰۰ هزار", "en": "500K"},
              "onTap": {"type": "set_state", "key": "amount", "value": 5000000}
            },
            {
              "type": "amount_chip",
              "amount": 10000000,
              "label": {"fa": "۱ میلیون", "en": "1M"},
              "onTap": {"type": "set_state", "key": "amount", "value": 10000000}
            },
            {
              "type": "amount_chip",
              "amount": 20000000,
              "label": {"fa": "۲ میلیون", "en": "2M"},
              "onTap": {"type": "set_state", "key": "amount", "value": 20000000}
            },
            {
              "type": "amount_chip",
              "amount": 50000000,
              "label": {"fa": "۵ میلیون", "en": "5M"},
              "onTap": {"type": "set_state", "key": "amount", "value": 50000000}
            },
            {
              "type": "amount_chip",
              "label": {"fa": "کل موجودی", "en": "All Balance"},
              "onTap": {"type": "set_state", "key": "amount", "value": "{{sourceCard.balance}}"}
            }
          ]
        }
      },
      
      {
        "id": "description_input",
        "type": "container",
        "padding": {"horizontal": 16},
        "child": {
          "type": "text_field",
          "label": {"fa": "توضیحات (اختیاری)", "en": "Description (optional)"},
          "hint": {"fa": "مثال: بابت هدیه تولد", "en": "e.g. Birthday gift"},
          "maxLength": 50,
          "bindTo": "description"
        }
      },
      
      {
        "id": "save_contact_switch",
        "type": "conditional",
        "condition": "{{!isExistingContact}}",
        "whenTrue": {
          "type": "container",
          "padding": 16,
          "child": {
            "type": "switch_tile",
            "title": {"fa": "ذخیره در مخاطبین", "en": "Save to Contacts"},
            "subtitle": {"fa": "برای انتقال‌های بعدی", "en": "For future transfers"},
            "value": "{{saveToContacts}}",
            "bindTo": "saveToContacts"
          }
        }
      },
      
      {
        "id": "contact_name_input",
        "type": "conditional",
        "condition": "{{saveToContacts && !isExistingContact}}",
        "whenTrue": {
          "type": "container",
          "padding": {"horizontal": 16},
          "child": {
            "type": "text_field",
            "label": {"fa": "نام مخاطب", "en": "Contact Name"},
            "hint": {"fa": "مثال: علی - دوست", "en": "e.g. Ali - Friend"},
            "initialValue": "{{destinationOwner}}",
            "bindTo": "contactName"
          }
        }
      },
      
      {
        "id": "limit_info",
        "type": "container",
        "padding": 16,
        "child": {
          "type": "card",
          "padding": 12,
          "backgroundColor": "#FFF8E1",
          "child": {
            "type": "column",
            "children": [
              {
                "type": "row",
                "mainAxisAlignment": "spaceBetween",
                "children": [
                  {
                    "type": "text",
                    "text": {"fa": "سقف روزانه:", "en": "Daily Limit:"},
                    "style": "bodySmall"
                  },
                  {
                    "type": "text",
                    "text": "{{formatCurrency(dailyLimit)}} ریال",
                    "style": "bodySmall"
                  }
                ]
              },
              {
                "type": "sized_box",
                "height": 4
              },
              {
                "type": "row",
                "mainAxisAlignment": "spaceBetween",
                "children": [
                  {
                    "type": "text",
                    "text": {"fa": "مصرف شده امروز:", "en": "Used Today:"},
                    "style": "bodySmall"
                  },
                  {
                    "type": "text",
                    "text": "{{formatCurrency(usedLimit)}} ریال",
                    "style": "bodySmall"
                  }
                ]
              },
              {
                "type": "sized_box",
                "height": 4
              },
              {
                "type": "linear_progress",
                "value": "{{usedLimit / dailyLimit}}",
                "color": "{{usedLimit / dailyLimit > 0.8 ? '#F44336' : '#4CAF50'}}"
              }
            ]
          }
        }
      },
      
      {
        "id": "bottom_spacing",
        "type": "sized_box",
        "height": 100
      }
    ]
  },
  
  "bottomBar": {
    "type": "container",
    "padding": 16,
    "decoration": {
      "color": "surface",
      "boxShadow": "0 -2px 8px rgba(0,0,0,0.1)"
    },
    "child": {
      "type": "elevated_button",
      "label": {"fa": "ادامه", "en": "Continue"},
      "fullWidth": true,
      "disabled": "{{!amount || amount < 10000 || amount > sourceCard.balance}}",
      "onTap": {
        "type": "navigate",
        "route": "/transfer/card-to-card/confirm",
        "params": {
          "sourceCardId": "{{sourceCardId}}",
          "destinationCardNumber": "{{destinationCardNumber}}",
          "destinationOwner": "{{destinationOwner}}",
          "destinationBank": "{{destinationBank}}",
          "amount": "{{amount}}",
          "description": "{{description}}",
          "saveToContacts": "{{saveToContacts}}",
          "contactName": "{{contactName}}"
        }
      }
    }
  },
  
  "dataBindings": {
    "sourceCardId": {"source": "route_param", "key": "sourceCardId"},
    "destinationCardNumber": {"source": "route_param", "key": "destinationCardNumber"},
    "destinationOwner": {"source": "route_param", "key": "destinationOwner"},
    "destinationBank": {"source": "route_param", "key": "destinationBank"},
    "sourceCard": {"source": "api", "endpoint": "dibalite/cards/{{sourceCardId}}"},
    "amount": {"source": "form", "default": 0},
    "description": {"source": "form", "default": ""},
    "saveToContacts": {"source": "form", "default": false},
    "contactName": {"source": "form", "default": ""},
    "dailyLimit": {"source": "api", "endpoint": "dibalite/limits/card-to-card", "key": "dailyLimit"},
    "usedLimit": {"source": "api", "endpoint": "dibalite/limits/card-to-card", "key": "usedToday"},
    "isExistingContact": {
      "source": "computed",
      "expression": "contacts.some(c => c.cardNumber === destinationCardNumber)"
    }
  },
  
  "mockData": {
    "sourceCard": "$ref:mock-data/cards.json#cards[0]",
    "dailyLimit": 100000000,
    "usedLimit": 25000000
  }
}

