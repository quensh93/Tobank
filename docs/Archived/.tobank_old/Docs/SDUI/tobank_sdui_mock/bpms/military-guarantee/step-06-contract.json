{
  "$schema": "tobank-sdui/v1/bpms-step",
  "version": "1.0.0",
  "stepId": "military_contract",
  "flowId": "military_guarantee",
  "stepNumber": 6,
  "title": {"fa": "امضای قرارداد", "en": "Sign Contract"},
  
  "appBar": {"type": "bpms_stepper", "title": {"fa": "ضمانت‌نامه نظام وظیفه", "en": "Military Guarantee"}, "currentStep": 6, "totalSteps": 7},
  
  "body": {
    "type": "scrollable",
    "padding": 16,
    "children": [
      {
        "type": "card",
        "padding": 20,
        "child": {
          "type": "column",
          "children": [
            {"type": "text", "text": {"fa": "خلاصه درخواست", "en": "Summary"}, "style": "titleLarge", "textAlign": "center"},
            {"type": "divider", "margin": {"vertical": 16}},
            {"type": "info_row", "label": {"fa": "نوع ضمانت‌نامه", "en": "Type"}, "value": "{{summary.typeName}}"},
            {"type": "info_row", "label": {"fa": "مبلغ", "en": "Amount"}, "value": "{{formatCurrency(summary.amount)}} ریال", "valueColor": "#607D8B", "margin": {"top": 8}},
            {"type": "info_row", "label": {"fa": "وثیقه", "en": "Collateral"}, "value": "{{formatCurrency(summary.collateral)}} ریال", "margin": {"top": 8}},
            {"type": "info_row", "label": {"fa": "اعتبار", "en": "Validity"}, "value": {"fa": "۱۲ ماه", "en": "12 months"}, "margin": {"top": 8}}
          ]
        }
      },
      
      {
        "type": "card",
        "margin": {"top": 24},
        "child": {
          "type": "column",
          "children": [
            {"type": "container", "height": 200, "padding": 16, "child": {"type": "scrollable", "child": {"type": "text", "text": "{{contractText}}", "style": "bodySmall"}}},
            {"type": "divider"},
            {"type": "container", "padding": 12, "child": {"type": "text_button", "icon": "assets/icons/ic_download.svg", "label": {"fa": "دانلود PDF", "en": "Download"}, "onTap": {"type": "download", "url": "{{contractPdfUrl}}"}}}
          ]
        }
      },
      
      {
        "type": "section",
        "margin": {"top": 24},
        "header": {"title": {"fa": "احراز هویت", "en": "Verification"}},
        "child": {
          "type": "conditional",
          "condition": "{{!ekycDone}}",
          "whenTrue": {"type": "elevated_button", "label": {"fa": "شروع احراز هویت", "en": "Start Verification"}, "fullWidth": true, "onTap": {"type": "start_ekyc", "onSuccess": {"type": "set_state", "key": "ekycDone", "value": true}}},
          "whenFalse": {"type": "container", "padding": 16, "decoration": {"color": "#E8F5E9", "borderRadius": 8}, "child": {"type": "row", "mainAxisAlignment": "center", "children": [{"type": "icon", "icon": "assets/icons/ic_check_circle.svg", "color": "#4CAF50"}, {"type": "sized_box", "width": 8}, {"type": "text", "text": {"fa": "تایید شد", "en": "Verified"}, "color": "#4CAF50"}]}}
        }
      },
      
      {"type": "checkbox_tile", "margin": {"top": 24}, "title": {"fa": "قرارداد را می‌پذیرم", "en": "I accept"}, "bindTo": "accepted"},
      {"type": "sized_box", "height": 100}
    ]
  },
  
  "bottomBar": {
    "type": "container",
    "padding": 16,
    "child": {
      "type": "row",
      "children": [
        {"type": "expanded", "child": {"type": "outlined_button", "label": {"fa": "قبلی", "en": "Back"}, "onTap": {"type": "navigate_back"}}},
        {"type": "sized_box", "width": 16},
        {"type": "expanded", "flex": 2, "child": {"type": "elevated_button", "label": {"fa": "امضا", "en": "Sign"}, "disabled": "{{!ekycDone || !accepted}}", "onTap": {"type": "api_call", "endpoint": "bpms/military-guarantee/sign", "method": "POST", "requireEkycSign": true, "onSuccess": {"type": "navigate_replace", "route": "/bpms/military-guarantee/step-07"}}}}
      ]
    }
  },
  
  "dataBindings": {
    "summary": {"source": "api", "endpoint": "bpms/military-guarantee/summary"},
    "contractText": {"source": "api", "endpoint": "bpms/military-guarantee/contract"},
    "ekycDone": {"source": "state", "default": false},
    "accepted": {"source": "form", "default": false}
  },
  
  "mockData": {
    "summary": {"typeName": {"fa": "معافیت تحصیلی", "en": "Education"}, "amount": 500000000, "collateral": 50000000},
    "contractText": "قرارداد ضمانت‌نامه بانکی نظام وظیفه\n\nماده ۱: طرفین قرارداد...\nماده ۲: موضوع ضمانت‌نامه...\nماده ۳: مدت اعتبار..."
  }
}

