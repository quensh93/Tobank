{
  "$schema": "tobank-sdui/v1/bpms-step",
  "version": "1.0.0",
  "stepId": "marriage_loan_customer_info",
  "flowId": "marriage_loan",
  "stepNumber": 2,
  "title": {
    "fa": "اطلاعات مشتری",
    "en": "Customer Information"
  },
  
  "appBar": {
    "type": "bpms_stepper",
    "title": {"fa": "تسهیلات ازدواج", "en": "Marriage Loan"},
    "currentStep": 2,
    "totalSteps": 8,
    "showBackButton": true
  },
  
  "body": {
    "type": "scrollable",
    "padding": 16,
    "children": [
      {
        "id": "personal_info_section",
        "type": "section",
        "header": {
          "title": {"fa": "اطلاعات شخصی", "en": "Personal Information"},
          "icon": "assets/icons/ic_profile.svg"
        },
        "child": {
          "type": "column",
          "children": [
            {
              "type": "text_field",
              "label": {"fa": "نام", "en": "First Name"},
              "icon": "assets/icons/ic_profile.svg",
              "value": "{{customer.firstName}}",
              "readOnly": true
            },
            {
              "type": "text_field",
              "label": {"fa": "نام خانوادگی", "en": "Last Name"},
              "margin": {"top": 16},
              "value": "{{customer.lastName}}",
              "readOnly": true
            },
            {
              "type": "text_field",
              "label": {"fa": "کد ملی", "en": "National ID"},
              "margin": {"top": 16},
              "value": "{{customer.nationalId}}",
              "readOnly": true
            },
            {
              "type": "text_field",
              "label": {"fa": "تاریخ تولد", "en": "Birth Date"},
              "margin": {"top": 16},
              "value": "{{customer.birthDate}}",
              "readOnly": true
            },
            {
              "type": "text_field",
              "label": {"fa": "نام پدر", "en": "Father's Name"},
              "margin": {"top": 16},
              "bindTo": "fatherName",
              "validation": {"required": true}
            }
          ]
        }
      },
      
      {
        "id": "contact_info_section",
        "type": "section",
        "margin": {"top": 24},
        "header": {
          "title": {"fa": "اطلاعات تماس", "en": "Contact Information"},
          "icon": "assets/icons/ic_phone.svg"
        },
        "child": {
          "type": "column",
          "children": [
            {
              "type": "text_field",
              "label": {"fa": "شماره موبایل", "en": "Mobile Number"},
              "icon": "assets/icons/ic_phone.svg",
              "value": "{{customer.mobile}}",
              "readOnly": true
            },
            {
              "type": "text_field",
              "label": {"fa": "تلفن ثابت", "en": "Landline"},
              "icon": "assets/icons/ic_phone_landline.svg",
              "margin": {"top": 16},
              "keyboardType": "phone",
              "hint": {"fa": "با کد شهر", "en": "With area code"},
              "bindTo": "landlinePhone",
              "validation": {"required": true, "pattern": "^0[0-9]{10}$"}
            },
            {
              "type": "text_field",
              "label": {"fa": "ایمیل (اختیاری)", "en": "Email (optional)"},
              "icon": "assets/icons/ic_email.svg",
              "margin": {"top": 16},
              "keyboardType": "email",
              "bindTo": "email"
            }
          ]
        }
      },
      
      {
        "id": "address_section",
        "type": "section",
        "margin": {"top": 24},
        "header": {
          "title": {"fa": "آدرس محل سکونت", "en": "Residential Address"},
          "icon": "assets/icons/ic_location.svg"
        },
        "child": {
          "type": "column",
          "children": [
            {
              "type": "dropdown_field",
              "label": {"fa": "استان", "en": "Province"},
              "dataSource": "provinces",
              "bindTo": "province",
              "onChange": {"type": "load_cities", "outputTo": "cities"}
            },
            {
              "type": "dropdown_field",
              "label": {"fa": "شهر", "en": "City"},
              "margin": {"top": 16},
              "dataSource": "cities",
              "bindTo": "city",
              "disabled": "{{!province}}"
            },
            {
              "type": "text_field",
              "label": {"fa": "آدرس کامل", "en": "Full Address"},
              "margin": {"top": 16},
              "maxLines": 3,
              "maxLength": 200,
              "bindTo": "address",
              "validation": {"required": true, "minLength": 20}
            },
            {
              "type": "text_field",
              "label": {"fa": "کد پستی", "en": "Postal Code"},
              "margin": {"top": 16},
              "keyboardType": "number",
              "maxLength": 10,
              "bindTo": "postalCode",
              "validation": {"required": true, "pattern": "^[0-9]{10}$"}
            }
          ]
        }
      },
      
      {
        "id": "employment_section",
        "type": "section",
        "margin": {"top": 24},
        "header": {
          "title": {"fa": "اطلاعات شغلی", "en": "Employment Information"},
          "icon": "assets/icons/ic_work.svg"
        },
        "child": {
          "type": "column",
          "children": [
            {
              "type": "dropdown_field",
              "label": {"fa": "نوع اشتغال", "en": "Employment Type"},
              "options": [
                {"value": "government", "label": {"fa": "کارمند دولت", "en": "Government Employee"}},
                {"value": "private", "label": {"fa": "کارمند بخش خصوصی", "en": "Private Sector"}},
                {"value": "self_employed", "label": {"fa": "خویش‌فرما", "en": "Self-Employed"}},
                {"value": "retired", "label": {"fa": "بازنشسته", "en": "Retired"}},
                {"value": "student", "label": {"fa": "دانشجو", "en": "Student"}},
                {"value": "unemployed", "label": {"fa": "بدون شغل", "en": "Unemployed"}}
              ],
              "bindTo": "employmentType",
              "validation": {"required": true}
            },
            {
              "type": "conditional",
              "condition": "{{employmentType && employmentType !== 'unemployed' && employmentType !== 'student'}}",
              "whenTrue": {
                "type": "column",
                "children": [
                  {
                    "type": "text_field",
                    "label": {"fa": "نام محل کار", "en": "Employer Name"},
                    "margin": {"top": 16},
                    "bindTo": "employerName"
                  },
                  {
                    "type": "currency_field",
                    "label": {"fa": "درآمد ماهیانه (ریال)", "en": "Monthly Income (Rials)"},
                    "margin": {"top": 16},
                    "currency": "IRR",
                    "showToman": true,
                    "bindTo": "monthlyIncome"
                  }
                ]
              }
            }
          ]
        }
      },
      
      {"type": "sized_box", "height": 100}
    ]
  },
  
  "bottomBar": {
    "type": "container",
    "padding": 16,
    "decoration": {"color": "surface", "boxShadow": "0 -2px 8px rgba(0,0,0,0.1)"},
    "child": {
      "type": "row",
      "children": [
        {
          "type": "expanded",
          "child": {
            "type": "outlined_button",
            "label": {"fa": "مرحله قبل", "en": "Previous"},
            "onTap": {"type": "navigate_back"}
          }
        },
        {"type": "sized_box", "width": 16},
        {
          "type": "expanded",
          "flex": 2,
          "child": {
            "type": "elevated_button",
            "label": {"fa": "مرحله بعد", "en": "Next"},
            "loading": "{{isValidating}}",
            "onTap": {
              "type": "validate_and_navigate",
              "validationApi": "bpms/marriage-loan/validate-customer",
              "nextRoute": "/bpms/marriage-loan/step-03"
            }
          }
        }
      ]
    }
  },
  
  "dataBindings": {
    "customer": {"source": "api", "endpoint": "dibalite/customer/profile"},
    "provinces": {"source": "api", "endpoint": "core/provinces"},
    "cities": {"source": "state", "default": []},
    "fatherName": {"source": "form", "default": ""},
    "landlinePhone": {"source": "form", "default": ""},
    "email": {"source": "form", "default": ""},
    "province": {"source": "form", "default": null},
    "city": {"source": "form", "default": null},
    "address": {"source": "form", "default": ""},
    "postalCode": {"source": "form", "default": ""},
    "employmentType": {"source": "form", "default": null},
    "employerName": {"source": "form", "default": ""},
    "monthlyIncome": {"source": "form", "default": 0},
    "isValidating": {"source": "state", "default": false}
  },
  
  "mockData": {
    "customer": {
      "firstName": "علی",
      "lastName": "احمدی",
      "nationalId": "۰۰۱۲۳۴۵۶۷۸",
      "birthDate": "۱۳۷۰/۰۵/۱۵",
      "mobile": "۰۹۱۲۳۴۵۶۷۸۹"
    },
    "provinces": "$ref:mock-data/provinces-cities.json#provinces"
  }
}

