# STAC Folder Structure Documentation

## Overview

The `lib/stac/` folder is the core directory for all STAC (Server-Driven UI) related files in the Tobank SDUI project. This folder contains everything needed for STAC-based development, including Dart widget definitions, JSON configurations, mock API responses, design system files, localization, and custom components.

## Purpose

This folder structure is designed to:
- **Centralize all STAC-related files** in a single, organized location within the `lib/` directory
- **Separate concerns** by organizing files into logical subdirectories
- **Support the STAC workflow**: Write Dart widgets → Build JSON → Use in app
- **Maintain clean architecture** with clear separation between source files and generated files

## Folder Structure

```
lib/stac/
├── .build/                    # Generated JSON files (STAC build output)
├── api_mock/                  # Mock API responses for development
│   ├── account/
│   ├── config/
│   ├── home/
│   ├── login/
│   ├── menu/
│   ├── otp/
│   ├── profile/
│   ├── test_input/
│   ├── theme/
│   ├── transactions/
│   └── transfer/
├── design_system/             # Theme and UI design system files
│   ├── tobank_theme_light.json
│   └── tobank_theme_dark.json
├── localization/              # Localization/translation files
│   └── GET_strings.json
├── actions/                   # Custom STAC actions (empty for now)
├── widgets/                   # Custom STAC widgets (empty for now)
├── registry/                  # STAC component registry
│   ├── custom_component_registry.dart
│   ├── register_custom_parsers.dart
│   └── registry.dart
├── tobank/                    # Feature-based screen definitions
│   ├── account/
│   │   ├── dart/
│   │   │   └── account_overview.dart
│   │   └── json/
│   ├── auth/
│   │   ├── dart/
│   │   │   └── register.dart
│   │   └── json/
│   ├── home/
│   │   ├── dart/
│   │   │   └── home.dart
│   │   └── json/
│   ├── login/
│   │   ├── dart/
│   │   │   ├── login.dart
│   │   │   └── verify_otp.dart
│   │   └── json/
│   ├── profile/
│   │   ├── dart/
│   │   │   └── profile.dart
│   │   └── json/
│   ├── transactions/
│   │   ├── dart/
│   │   │   └── transaction_history.dart
│   │   └── json/
│   ├── transfer/
│   │   ├── dart/
│   │   │   └── transfer_form.dart
│   │   └── json/
│   └── tobank_menu.dart
├── default_stac_options.dart  # STAC CLI configuration
└── README.md                  # This folder's documentation
```

## Directory Descriptions

### `.build/`

**Purpose**: Contains JSON files generated by the STAC CLI build process.

**Content**: 
- Generated JSON files from Dart widget files in `tobank/` subdirectories
- Files are automatically created when running `stac build`
- These files are consumed by the app at runtime

**Usage**:
- DO NOT manually edit files in this directory
- Files are generated from `tobank/` Dart files
- Generated files are committed to git for reference

**Example Files**:
- `tobank_login.json`
- `tobank_home.json`
- `tobank_menu.json`

---

### `api_mock/`

**Purpose**: Contains mock API response files for development and testing.

**Structure**: Organized by feature/module (account, login, home, etc.)

**File Naming Convention**: `{HTTP_METHOD}_{endpoint}.json`
- Example: `GET_tobank_login.json` for `GET https://api.tobank.com/login`
- Example: `GET_validation-labels.json` for validation label endpoints

**Content Format**: Mock files wrap responses in API format:
```json
{
  "GET": {
    "statusCode": 200,
    "data": {
      // Actual response data
    }
  }
}
```

**Subdirectories**:
- `account/` - Account-related API mocks
- `config/` - App configuration API mocks
- `home/` - Home screen API mocks
- `login/` - Authentication API mocks
- `menu/` - Menu/navigation API mocks
- `otp/` - OTP verification API mocks
- `profile/` - Profile API mocks
- `test_input/` - Test input API mocks
- `theme/` - Theme-related API mocks (colors, styles)
- `transactions/` - Transaction API mocks
- `transfer/` - Transfer API mocks

---

### `design_system/`

**Purpose**: Central location for all theme and UI design system files.

**Content**: 
- Theme JSON files (light and dark themes)
- Style definitions including style aliases
- Color definitions
- This is the ONLY directory for theme-related files

**Files**:
- `tobank_theme_light.json` - Light theme configuration
- `tobank_theme_dark.json` - Dark theme configuration
- `GET_styles.json` - Component style definitions (including style aliases like `appbarStyle`)
- `GET_colors.json` - Color definitions for both themes

**Rules**:
- All theme files must be in this directory
- No theme files should exist outside this directory
- Files are loaded using `TobankThemeLoader` and `TobankStylesLoader`
- Style aliases should be defined here to reduce JSON payload size

---

### `localization/`

**Purpose**: Central location for all localization/translation strings.

**Content**:
- Single JSON file containing all app strings
- This is the ONLY directory for localization files

**Files**:
- `GET_strings.json` - All app strings in JSON format

**Rules**:
- All localization files must be in this directory
- No localization files should exist outside this directory
- Files are loaded at app startup via `TobankStringsLoader`

---

### `actions/`

**Purpose**: Custom STAC action parsers.

**Status**: Currently empty - reserved for future custom actions

**Rules**:
- Each custom action should be in its own file
- Actions extend `StacActionParser`
- Actions are registered via the registry system

---

### `widgets/`

**Purpose**: Custom STAC widget parsers.

**Status**: Currently empty - reserved for future custom widgets

**Rules**:
- Each custom widget should be in its own file
- Widgets extend `StacParser`
- Widgets are registered via the registry system

---

### `registry/`

**Purpose**: Component registration system for custom parsers.

**Files**:
- `custom_component_registry.dart` - Registry implementation
- `register_custom_parsers.dart` - Registration logic
- `registry.dart` - Registry exports

**Usage**: 
- Registers custom widgets and actions with STAC framework
- Called during app initialization

---

### `tobank/`

**Purpose**: Feature-based screen definitions using STAC Dart widgets.

**Structure Rules**:
1. **Each subfolder represents a feature/module** (account, login, home, etc.)
2. **Each feature folder MUST follow this structure**:
   ```
   feature_name/
   ├── dart/          # STAC Dart widget files
   └── json/          # JSON files and data binding files
   ```

#### `dart/` Subfolder

**Purpose**: Contains STAC Flutter/Dart widget definitions.

**Usage**:
- Write screens using STAC widgets (e.g., `StacWidget`, `StacContainer`)
- These are Flutter widgets that can be previewed in the app
- Use `stac build` command to generate JSON files from these Dart files

**Example**: `login/dart/login.dart`
```dart
import 'package:stac/stac.dart';

StacWidget tobankLogin() {
  return StacContainer(
    // STAC widget definitions
  );
}
```

**Workflow**:
1. Write/design screen in Dart using STAC widgets
2. Preview in app to verify UI
3. Run `stac build` to generate JSON
4. Generated JSON appears in `.build/` folder

#### `json/` Subfolder

**Purpose**: Contains JSON UI files and data binding files for the feature.

**Content**:
- UI template JSON files
- Data binding JSON files
- Feature-specific configuration files

**Usage**: 
- Store JSON files used for data binding
- Template files for screen variations
- Feature-specific configuration

---

### `default_stac_options.dart`

**Purpose**: Configuration file for STAC CLI.

**Content**:
- `sourceDir`: Points to where STAC Dart files are located (`lib/stac/tobank/`)
- `outputDir`: Points to where generated JSON files go (`lib/stac/.build/`)

**Usage**: 
- Used by `stac build` command
- Defines source and output directories

---

## Workflow

### Creating a New Screen

1. **Create feature folder structure** (if doesn't exist):
   ```
   lib/stac/tobank/new_feature/
   ├── dart/
   └── json/
   ```

2. **Write Dart widget** in `dart/new_feature.dart`:
   ```dart
   StacWidget newFeature() {
     return StacContainer(
       // Your STAC widgets
     );
   }
   ```

3. **Preview in app** to verify UI design

4. **Build JSON** using STAC CLI:
   ```bash
   stac build
   ```

5. **Generated JSON** appears in `lib/stac/.build/new_feature.json`

6. **Use in app** - The app loads from `.build/` folder

### Adding Mock API Response

1. Identify the feature/module (e.g., `login`, `home`)

2. Create file in appropriate `api_mock/` subfolder:
   ```
   lib/stac/api_mock/login/GET_new-endpoint.json
   ```

3. Format as API response:
   ```json
   {
     "GET": {
       "statusCode": 200,
       "data": {
         // Response data
       }
     }
   }
   ```

4. Update `pubspec.yaml` if adding new subfolder (assets must be explicitly listed)

## File Path Rules

### Import Paths in Code

- **From `lib/`**: Use relative imports like `import 'stac/registry/registry.dart';`
- **From other folders**: Use full path from `lib/`, e.g., `import 'package:tobank_sdui/stac/registry/registry.dart';`

### Asset Paths

- **Theme files**: `stac/design_system/tobank_theme_light.json`
- **Localization**: `stac/localization/GET_strings.json`
- **Generated JSON**: `stac/.build/tobank_login.json`
- **Mock API**: `stac/api_mock/{feature}/GET_{endpoint}.json`

## STAC CLI Configuration

The `default_stac_options.dart` file configures:
- `sourceDir: 'lib/stac/tobank/'` - Where to find Dart widget files
- `outputDir: 'lib/stac/.build/'` - Where to output generated JSON

## Migration from Old Structure

This structure replaces the old root-level `stac/` folder. Key changes:
- ✅ Moved from `stac/` (root) to `lib/stac/`
- ✅ Added `design_system/` for theme files
- ✅ Added `localization/` for strings
- ✅ Organized `tobank/` with `dart/` and `json/` subfolders
- ✅ Centralized all STAC-related files in one place

## Style Alias Pattern ⭐ **NEW RULE**

**Always use style aliases instead of inline style objects to reduce JSON payload size.**

### Rule
When defining text styles (or any reusable styles), define them once in `GET_styles.json` and reference them using style aliases throughout the app.

### Implementation

**1. Define Style in `design_system/GET_styles.json`:**
```json
{
  "GET": {
    "statusCode": 200,
    "data": {
      "appbarStyle": {
        "color": "{{appColors.current.text.title}}",
        "fontSize": 20.0,
        "fontWeight": "w400"
      }
    }
  }
}
```

**2. Use in Dart:**
```dart
StacText(
  data: '{{appStrings.login.validationTitle}}',
  style: StacAliasTextStyle('{{appStyles.appbarStyle}}'),
)
```

**3. Use in JSON:**
```json
{
  "type": "text",
  "data": "{{appStrings.login.validationTitle}}",
  "style": "{{appStyles.appbarStyle}}"
}
```

### Benefits
- **Reduced JSON Size**: Instead of repeating full style objects, use a single string reference
- **Consistency**: Styles defined once, used everywhere
- **Maintainability**: Update style in one place, affects all usages
- **Performance**: Smaller JSON payloads = faster network transfers

**This pattern is now mandatory for all new style definitions!**

## Best Practices

1. **Always use the structured folders** - Don't create files outside the defined structure
2. **Follow naming conventions** - Use consistent naming for files and folders
3. **Keep generated files separate** - Never manually edit `.build/` files
4. **Organize by feature** - Group related files in feature folders
5. **Document custom components** - Add documentation for custom widgets/actions
6. **Update imports when moving files** - Always update all import paths
7. **Use style aliases** - Always use style aliases for complete style objects to reduce JSON size ⭐

## Important Links

- **Complete Guide**: [`docs/TOBANK_STAC_SDUI_COMPLETE_GUIDE.md`](../TOBANK_STAC_SDUI_COMPLETE_GUIDE.md)
- **Issues Log**: [`docs/AI/Issues/ISSUES_LOG.md`](../AI/Issues/ISSUES_LOG.md)

## Notes

- The `lib/stac/` folder is tracked in git
- All files in this folder are part of the project codebase
- The `.build/` folder contains generated files but should be committed for reference
- Custom components (actions/widgets) extend the STAC framework without modifying core packages
- **Assets must stay at root `stac/`** - Flutter requirement
